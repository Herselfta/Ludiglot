# 快速测试指南

本文档说明如何测试2026-01-23的修复。

## 测试环境要求

- Python 3.10+
- 已安装项目依赖（见 requirements.txt）

## 测试步骤

### 1. 语法检查（已通过 ✓）

```bash
python -m py_compile src/ludiglot/ui/overlay_window.py
```

### 2. 单元测试

运行文本匹配算法测试：

```bash
python tools/test_match_fix.py
```

预期输出：
```
✓ 所有测试通过！
```

运行原有测试：

```bash
python test_smart_match.py
```

预期输出：
```
测试完成！
```

### 3. 集成测试

启动GUI程序：

```bash
python -m ludiglot
# 或
python run_mvp.ps1
```

### 4. 功能验证

#### 问题1: 窗口关闭速度

1. 启动程序
2. 触发显示窗口（快捷键或截图）
3. **点击窗口外部区域**
4. 观察窗口是否**立即**关闭（应该<100ms）

✓ **预期结果**: 窗口立即关闭，无延迟

#### 问题2: 文本匹配准确性

1. 准备测试图片：包含长文本描述（如技能描述，50+词）
2. 使用框选截图功能捕获
3. 查看匹配结果

✓ **预期结果**: 
   - 匹配到完整的长文本描述
   - **不会**匹配到单个单词（如 "attack"）
   - 日志中应显示 "[MATCH] 长度不匹配惩罚" 信息（如果有不当候选）

### 5. 性能对比

#### 窗口关闭响应时间

**修复前**:
- 点击窗口外部 → 延迟 300-800ms
- 感觉"卡顿"

**修复后**:
- 点击窗口外部 → 延迟 <50ms
- 感觉"即时响应"

## 日志检查

查看日志文件：`log/gui.log`

### 窗口事件日志

应该看到：
```
[WINDOW] 显示
[WINDOW] 隐藏
```

**不应该**看到：
```
[WINDOW] 失焦，隐藏窗口  （已优化，移除日志）
[WINDOW] 捕获到窗口外点击  （已移除此功能）
[WINDOW] 全局鼠标监听不可用  （已移除监听器）
```

### 匹配日志

对于长文本，应该看到：
```
[SEARCH] 智能匹配策略=mixed, 评估 3 个候选...
[MATCH] 长度不匹配惩罚: query_len=61, matched_len=6
[SEARCH] 耗时: 0.15s, 最佳匹配: <完整文本> (score=0.95)
```

## 回归测试清单

- [ ] 短标题识别正常
- [ ] 长文本识别正常
- [ ] 混合内容（标题+描述）识别正常
- [ ] 列表模式识别正常
- [ ] 窗口拖拽正常
- [ ] 窗口调整大小正常
- [ ] 快捷键功能正常
- [ ] 音频播放功能正常

## 已知限制

无已知问题。

## 如果发现问题

1. 检查日志文件：`log/gui.log`
2. 运行单元测试：`python tools/test_match_fix.py`
3. 提供以下信息：
   - 错误信息
   - 日志片段
   - 复现步骤
   - 测试图片（如果相关）

## 版本信息

- **修复日期**: 2026-01-23
- **修复文件**: src/ludiglot/ui/overlay_window.py
- **测试脚本**: tools/test_match_fix.py
- **详细报告**: docs/FIX_REPORT_2026-01-23.md
